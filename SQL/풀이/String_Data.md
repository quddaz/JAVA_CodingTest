> LV.2 자동차 평균 대여 기간 구하기 

```sql
SELECT CAR_ID, ROUND(AVG(DATEDIFF(END_DATE, START_DATE) + 1), 1) AS AVERAGE_DURATION
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
GROUP BY CAR_ID
HAVING AVERAGE_DURATION >= 7
ORDER BY AVERAGE_DURATION DESC, CAR_ID DESC;
```

> LV.3 조회수가 가장 많은 중고거래 게시판의 첨부파일 조회하기 

```sql
WITH MAX_TABLE AS (
    SELECT BOARD_ID
    FROM USED_GOODS_BOARD
    ORDER BY VIEWS DESC
    LIMIT 1
)

SELECT CONCAT('/home/grep/src/', BOARD_ID, '/', FILE_ID, FILE_NAME,FILE_EXT) AS FILE_PATH
FROM USED_GOODS_FILE
WHERE BOARD_ID IN (SELECT BOARD_ID FROM MAX_TABLE)
ORDER BY FILE_ID DESC;
```

> LV.2 조건에 부합하는 중고거래 상태 조회하기 

```sql
SELECT BOARD_ID, WRITER_ID, TITLE, PRICE, 
       CASE 
           WHEN STATUS = 'SALE' THEN '판매중' 
           WHEN STATUS = 'DONE' THEN '거래완료' 
           ELSE '예약중' 
       END AS STATUS
FROM USED_GOODS_BOARD
WHERE CREATED_DATE = '2022-10-05'
ORDER BY 1 DESC
```

> LV.4 자동차 대여 기록 별 대여 금액 구하기 

```sql
WITH T AS (
    SELECT H.HISTORY_ID, H.CAR_ID, C.DAILY_FEE,
           DATEDIFF(H.END_DATE, H.START_DATE) + 1 AS RENTAL_DAYS,
           CASE 
               WHEN DATEDIFF(H.END_DATE, H.START_DATE) + 1 >= 90 THEN '90일 이상'
               WHEN DATEDIFF(H.END_DATE, H.START_DATE) + 1 >= 30 THEN '30일 이상'
               WHEN DATEDIFF(H.END_DATE, H.START_DATE) + 1 >= 7 THEN '7일 이상'
               ELSE NULL
           END AS DURATION_TYPE
    FROM CAR_RENTAL_COMPANY_CAR C
    JOIN CAR_RENTAL_COMPANY_RENTAL_HISTORY H 
    ON C.CAR_ID = H.CAR_ID
    WHERE C.CAR_TYPE = '트럭'
)

SELECT T.HISTORY_ID, 
       FLOOR((T.RENTAL_DAYS * T.DAILY_FEE) * (1 - COALESCE(P.DISCOUNT_RATE, 0) / 100.0)) AS FEE
FROM T
LEFT JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN P 
ON P.CAR_TYPE = '트럭' AND T.DURATION_TYPE = P.DURATION_TYPE
ORDER BY FEE DESC, HISTORY_ID DESC;
```
