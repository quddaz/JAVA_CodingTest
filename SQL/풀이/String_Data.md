> LV.2 자동차 평균 대여 기간 구하기 

```sql
SELECT CAR_ID, ROUND(AVG(DATEDIFF(END_DATE, START_DATE) + 1), 1) AS AVERAGE_DURATION
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
GROUP BY CAR_ID
HAVING AVERAGE_DURATION >= 7
ORDER BY AVERAGE_DURATION DESC, CAR_ID DESC;
```

> LV.3 조회수가 가장 많은 중고거래 게시판의 첨부파일 조회하기 

```sql
WITH MAX_TABLE AS (
    SELECT BOARD_ID
    FROM USED_GOODS_BOARD
    ORDER BY VIEWS DESC
    LIMIT 1
)

SELECT CONCAT('/home/grep/src/', BOARD_ID, '/', FILE_ID, FILE_NAME,FILE_EXT) AS FILE_PATH
FROM USED_GOODS_FILE
WHERE BOARD_ID IN (SELECT BOARD_ID FROM MAX_TABLE)
ORDER BY FILE_ID DESC;
```

> LV.2 조건에 부합하는 중고거래 상태 조회하기 

```sql
SELECT BOARD_ID, WRITER_ID, TITLE, PRICE, 
       CASE 
           WHEN STATUS = 'SALE' THEN '판매중' 
           WHEN STATUS = 'DONE' THEN '거래완료' 
           ELSE '예약중' 
       END AS STATUS
FROM USED_GOODS_BOARD
WHERE CREATED_DATE = '2022-10-05'
ORDER BY 1 DESC
```

> LV.4 자동차 대여 기록 별 대여 금액 구하기 

```sql
WITH T AS (
    SELECT H.HISTORY_ID, H.CAR_ID, C.DAILY_FEE,
           DATEDIFF(H.END_DATE, H.START_DATE) + 1 AS RENTAL_DAYS,
           CASE 
               WHEN DATEDIFF(H.END_DATE, H.START_DATE) + 1 >= 90 THEN '90일 이상'
               WHEN DATEDIFF(H.END_DATE, H.START_DATE) + 1 >= 30 THEN '30일 이상'
               WHEN DATEDIFF(H.END_DATE, H.START_DATE) + 1 >= 7 THEN '7일 이상'
               ELSE NULL
           END AS DURATION_TYPE
    FROM CAR_RENTAL_COMPANY_CAR C
    JOIN CAR_RENTAL_COMPANY_RENTAL_HISTORY H 
    ON C.CAR_ID = H.CAR_ID
    WHERE C.CAR_TYPE = '트럭'
)

SELECT T.HISTORY_ID, 
       FLOOR((T.RENTAL_DAYS * T.DAILY_FEE) * (1 - COALESCE(P.DISCOUNT_RATE, 0) / 100.0)) AS FEE
FROM T
LEFT JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN P 
ON P.CAR_TYPE = '트럭' AND T.DURATION_TYPE = P.DURATION_TYPE
ORDER BY FEE DESC, HISTORY_ID DESC;
```

> LV.3 조건별로 분류하여 주문상태 출력하기 

```sql
SELECT ORDER_ID, PRODUCT_ID, DATE_FORMAT(OUT_DATE, '%Y-%m-%d'),
        CASE 
        WHEN OUT_DATE IS NULL THEN '출고미정' 
        WHEN OUT_DATE <= '2022-05-01' THEN '출고완료'
        ELSE '출고대기'
        END AS 출고여부
FROM FOOD_ORDER
ORDER BY 1 ASC
```

> LV.3 조건에 맞는 사용자 정보 조회하기

```sql
WITH USER_COUNT AS(
SELECT U.USER_ID, U.NICKNAME, CONCAT(U.CITY,' ',U.STREET_ADDRESS1, ' ',U.STREET_ADDRESS2) AS ADDRESS, COUNT(*) AS C, U.TLNO
FROM USED_GOODS_USER U
JOIN USED_GOODS_BOARD B ON U.USER_ID = B.WRITER_ID
GROUP BY USER_ID
)

SELECT USER_ID, NICKNAME, ADDRESS AS 전체주소, CONCAT(SUBSTRING(TLNO, 1,3), '-',SUBSTRING(TLNO, 4,4), '-', SUBSTRING(TLNO, 8,4)) AS 전화번호
FROM USER_COUNT
WHERE C >= 3
ORDER BY USER_ID DESC
```

> LV.4 취소되지 않은 진료 예약 조회하기

```sql
WITH FORMAT AS(
    SELECT APNT_YMD, APNT_NO, PT_NO, MCDP_CD, MDDR_ID
    FROM APPOINTMENT
    WHERE DATE_FORMAT(APNT_YMD, '%Y-%m-%d') = '2022-04-13' AND MCDP_CD = 'CS' AND APNT_CNCL_YN = 'N'
)
SELECT F.APNT_NO, P.PT_NAME, P.PT_NO, F.MCDP_CD, D.DR_NAME, F.APNT_YMD
FROM FORMAT F
JOIN DOCTOR D ON F.MDDR_ID = D.DR_ID
JOIN PATIENT P ON F.PT_NO = P.PT_NO
ORDER BY F.APNT_YMD ASC
```
